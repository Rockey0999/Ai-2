<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MoodMirror AI - Live</title>
    
    <link rel="stylesheet" href="https://pyscript.net/releases/2024.1.1/core.css" />
    <script type="module" src="https://pyscript.net/releases/2024.1.1/core.js"></script>

    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #1a1a2e; color: white; text-align: center; padding: 20px; }
        .container { max-width: 800px; margin: auto; background: #16213e; padding: 30px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        h1 { color: #4ecca3; margin-bottom: 5px; }
        .tagline { color: #95a5a6; margin-bottom: 30px; }
        textarea { width: 90%; height: 100px; border-radius: 10px; padding: 10px; margin-bottom: 20px; border: none; font-size: 16px; }
        button { background-color: #4ecca3; color: #1a1a2e; border: none; padding: 15px 30px; font-weight: bold; border-radius: 8px; cursor: pointer; font-size: 18px; transition: 0.3s; }
        button:hover { background-color: #45b391; transform: scale(1.05); }
        .result-box { margin-top: 30px; padding: 20px; border: 1px dashed #4ecca3; border-radius: 10px; background: #0f3460; display: none; }
        #camera-area { margin: 20px 0; border-radius: 10px; overflow: hidden; border: 2px solid #4ecca3; width: 320px; height: 240px; margin-left: auto; margin-right: auto; }
        video { width: 100%; height: 100%; object-fit: cover; }
    </style>
</head>
<body>

    <div class="container">
        <h1>ðŸªž MoodMirror AI</h1>
        <p class="tagline">Class 12 AI Project: Emotional Detection & Study Optimization</p>

        <div id="camera-area">
            <video id="webcam" autoplay playsinline></video>
        </div>

        <textarea id="user_input" placeholder="Type how you are feeling right now..."></textarea>
        <br>
        <button id="analyze_btn" py-click="process_mood">START AI ANALYSIS</button>

        <div id="result_panel" class="result-box">
            <h3 id="res_emotion">Emotion: Detecting...</h3>
            <h3 id="res_sentiment">Sentiment: --</h3>
            <hr>
            <p id="res_advice" style="color: #f1c40f; font-style: italic; font-size: 18px;"></p>
        </div>
    </div>

    <script type="py">
        from pyscript import document
        import random

        # Mock Emotion Logic (since .h5 loading is heavy for 1-file HTML)
        EMOTIONS = ["Happy", "Neutral", "Sad", "Tired", "Focused"]

        def get_sentiment(text):
            # A simple rule-based sentiment engine for browser compatibility
            positive_words = ["good", "happy", "great", "fine", "confident", "motivated", "excited"]
            negative_words = ["sad", "bad", "tired", "stressed", "bored", "depressed", "hard"]
            
            score = 0
            words = text.lower().split()
            for word in words:
                if word in positive_words: score += 1
                if word in negative_words: score -= 1
            
            if score > 0: return "Positive"
            if score < 0: return "Negative"
            return "Neutral"

        def get_advice(emotion, sentiment):
            if sentiment == "Negative" or emotion == "Sad":
                return "ðŸ’¡ Recommendation: Take a 10-minute break. Try deep breathing or a short walk."
            elif emotion == "Happy" or sentiment == "Positive":
                return "ðŸ’¡ Recommendation: You are in a great state! Tackle your hardest subject right now."
            else:
                return "ðŸ’¡ Recommendation: Keep a steady pace. Review your summary notes."

        def process_mood(event):
            # 1. Get User Text
            input_text = document.getElementById("user_input").value
            
            # 2. Run Python Logic
            sentiment = get_sentiment(input_text)
            emotion = random.choice(EMOTIONS) # Simulation for browser version
            advice = get_advice(emotion, sentiment)

            # 3. Update UI
            document.getElementById("res_emotion").innerText = f"Detected Emotion: {emotion}"
            document.getElementById("res_sentiment").innerText = f"Text Sentiment: {sentiment}"
            document.getElementById("res_advice").innerText = advice
            document.getElementById("result_panel").style.display = "block"
    </script>

    <script>
        const video = document.getElementById('webcam');
        navigator.mediaDevices.getUserMedia({ video: true })
            .then(stream => { video.srcObject = stream; })
            .catch(err => { console.error("Webcam Error: ", err); });
    </script>

</body>
</html>
